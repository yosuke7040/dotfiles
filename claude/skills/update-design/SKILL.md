---
name: update-design
description: 計画または設計書（ADR/機能設計書/Plan File）を作成・更新した後に発動。100点満点で自己評価し、不足点をタスクリストにして設計書を改善。矛盾や収載漏れがないことを最終確認する。
---

# update-design

設計書の品質を評価し、不足点を改善する。

## 対象ファイル

$ARGUMENTS でパスを指定。指定がなければ以下から最新を検出:
- `docs/adr/YYYYMMDD_*.md` - ADR
- `docs/feat/YYYYMMDD_*.md` - 機能設計書
- `.claude/plans/*.md` - Plan File
- `~/.claude/plans/*.md` - グローバル Plan File

## 評価観点

4観点で採点（各25点、合計100点）:

| 観点 | 評価ポイント |
|------|-------------|
| 構造的完全性 | 必須セクションの有無、見出し階層 |
| 論理的一貫性 | 決定と理由の整合性、矛盾の有無 |
| 具体性・実装可能性 | コード例、ファイルパス、手順の具体性 |
| 網羅性 | 影響範囲、エッジケース、テスト観点 |

## 必須セクション

### ADR
- TL;DR（要約）
- 背景/課題
- 決定（Decision）
- 理由（Rationale）
- 代替案（Alternatives）
- 影響（Consequences）

### 機能設計書
- 概要・背景
- 要件
- アーキテクチャ図
- 改修対象ファイル
- 実装フェーズ
- テスト観点

### Plan File
- 概要（何を実装するか）
- 作成/変更ファイル
- 実装内容/実装手順
- 検証方法

## 実行手順

1. 対象ファイルを特定（$ARGUMENTS または最新検出）
2. 種別判定（ADR/機能設計書/Plan File）
3. 4観点で評価・採点
4. スコア80点未満 または クリティカル項目あり → 改善実施（最大3回）
5. 最終レポート出力

**クリティカル項目**:
- 決定事項が不明確
- 実装方針が具体的でない
- セクション間で矛盾がある

## 出力

評価レポートを以下の形式で出力:

```markdown
## 設計書評価レポート

### 対象: `<ファイルパス>`

### スコア: XX / 100 点

| 観点 | スコア | 評価 |
|------|--------|------|
| 構造的完全性 | XX/25 | ◎○△× |
| 論理的一貫性 | XX/25 | ◎○△× |
| 具体性・実装可能性 | XX/25 | ◎○△× |
| 網羅性 | XX/25 | ◎○△× |

### 改善が必要な点
1. [観点] - [項目]: 改善方法

### 判定: ✅ 合格 / ⚠️ 要改善
```
