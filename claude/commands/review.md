---
description: ブランチ差分のコードレビュー
---

**コマンドコンテキスト**: 実装完了後のコードレビュー専用コマンド

ベースブランチ（省略時はmain）: $ARGUMENTS

**Think deeply** コードレビューの本質を理解し、以下のステップで実行：

## 実行フロー

### 1. ブランチ差分の取得

```bash
# ベースブランチの決定（引数がある場合はそれを使用、なければmain）
BASE_BRANCH="${ARGUMENTS:-main}"

# 差分ファイル一覧取得
git diff --name-only $BASE_BRANCH...HEAD

# 詳細な差分取得（レビュー用）
git diff $BASE_BRANCH...HEAD
```

### 2. 変更内容の分析

変更されたファイルを分析し、以下を判定：
- バックエンド/フロントエンド/その他の分類
- 変更の性質（新規機能、バグ修正、リファクタリング等）
- 影響範囲の特定

### 3. code-reviewerエージェント実行

プロジェクトタイプに応じた観点でレビュー：

#### 🏗️ バックエンド観点（クリーンアーキテクチャ・DDD）

**アーキテクチャ準拠**:
- レイヤー分離の適切性（Presentation → Application → Domain → Infrastructure）
- 依存関係の方向性（内側のレイヤーは外側に依存しない）
- ドメインロジックがDomain層に集約されているか

**DDD準拠**:
- Entity、ValueObject、Aggregateの適切な設計
- ドメインイベントの活用
- Repository、Serviceの責務分離
- ユビキタス言語の使用

**その他**:
- ビジネスロジックのテストカバレッジ
- エラーハンドリング
- トランザクション管理

#### 🎨 フロントエンド観点

**UI/ロジック分離**:
- Presentational ComponentとContainer Componentの分離
- ビジネスロジックがコンポーネントから分離されているか
- UIコンポーネントの再利用性

**Hooks使用法**:
- カスタムフックの適切な抽象化
- useEffect、useMemoの適切な依存配列
- 不要な再レンダリングの防止
- Hooks命名規則（use〜）の遵守

**ファイル配置**:
- コンポーネントの適切なディレクトリ構造
- 共通コンポーネント（components/）vs 機能別（features/）の使い分け
- hooks、utils、typesの適切な配置
- 関心の分離（1ファイル1責務）

**その他**:
- 型安全性（TypeScript活用）
- パフォーマンス最適化
- アクセシビリティ（a11y）

#### 🔍 共通観点

**コード品質**:
- 命名規則の一貫性
- 関数/メソッドの適切な長さ（目安: 500行以下/ファイル）
- 循環的複雑度
- コメントの適切性
- DRY原則の遵守

**テスト**:
- テストカバレッジ
- テストの可読性と保守性
- エッジケースのカバー

**セキュリティ**:
- 入力値検証
- 認証・認可
- 機密情報の扱い
- SQLインジェクション、XSS等の脆弱性

**パフォーマンス**:
- N+1問題
- 不要なデータ取得
- キャッシュ戦略
- 非効率なアルゴリズム

**保守性**:
- モジュール性
- 拡張性
- ドキュメント
- 技術的負債

### 4. レビュー結果レポート

```markdown
## コードレビュー結果

**ブランチ**: HEAD vs $BASE_BRANCH
**変更ファイル数**: [N]ファイル
**変更行数**: +[X]/-[Y]

### 📋 変更概要
[変更内容のサマリー]

### ✅ Good Points
- [良い実装のポイント]

### ⚠️ Issues Found

#### 🔴 Critical（必須修正）
- [重大な問題]

#### 🟡 Warning（推奨修正）
- [改善推奨事項]

#### 🔵 Suggestion（検討事項）
- [さらなる改善案]

### 🎯 アーキテクチャ/設計評価

#### バックエンド
- クリーンアーキテクチャ準拠: [評価]
- DDD準拠: [評価]

#### フロントエンド
- UI/ロジック分離: [評価]
- Hooks使用: [評価]
- ファイル構成: [評価]

### 📊 総合評価
品質スコア: [X]/100

**推奨アクション**:
- [次のステップ]
```

## レビュー品質基準

**Critical判定基準**:
- セキュリティ脆弱性
- アーキテクチャ原則の重大な違反
- データ損失リスク
- パフォーマンス重大問題

**Warning判定基準**:
- 保守性の問題
- テスト不足
- 軽微なアーキテクチャ違反
- コード重複

**Suggestion判定基準**:
- より良い実装方法の提案
- パフォーマンス最適化の余地
- リファクタリング機会

**スコープ**: ブランチ差分のコードレビューと改善提案まで。
