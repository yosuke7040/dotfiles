---
description: オーケストレーターとして要件分析から実装まで完全サイクルを管理
---

**コマンドコンテキスト**: 実装の完全サイクル管理（要件分析→設計→計画→実装→品質保証）

@docs/guides/sub-agents.md を厳守し、オーケストレーターとして振る舞います。

## 実行判断フロー

### 1. 現在状況の判定
指示内容: $ARGUMENTS

**Think deeply** 現在の状況を判定：

| 状況パターン | 判定基準 | 次のアクション |
|------------|---------|-------------|
| 新規要件 | 既存作業なし、新しい機能/修正依頼 | requirement-analyzerから開始 |
| フロー継続 | 既存ドキュメント/タスクあり、継続指示 | sub-agents.mdのフローで次のステップを特定 |
| 品質エラー | エラー検出、テスト失敗、ビルドエラー | quality-fixer実行 |
| 不明瞭 | 意図が曖昧、複数の解釈が可能 | ユーザーに確認 |

### 2. 継続時の進捗確認
フロー継続の場合、以下を確認：
- 最新の成果物（PRD/ADR/Design Doc/作業計画書/タスク）
- 現在のフェーズ位置（要件/設計/計画/実装/品質保証）
- sub-agents.mdの該当フローで次のステップを特定

### 3. 次のアクション実行

**sub-agents.mdを必ず参照**：
- 規模別フロー（大規模/中規模/小規模）を確認
- 自律実行モードの条件を確認
- 必須停止ポイントを認識
- フローに定義された次のサブエージェントを呼び出す

## 📋 sub-agents.md準拠の実行

**実行前チェック（必須）**：
- [ ] sub-agents.mdの該当フローを確認した
- [ ] 現在の進捗位置を特定した
- [ ] 次のステップを明確にした
- [ ] 停止ポイントを認識した
- [ ] タスク実行後の品質サイクル（task → quality-check → commit）を理解した

**フロー逸脱禁止**: sub-agents.mdに定義されたフローから外れることは禁止。特に：
- quality-fixerを飛ばしてコミットしない
- 自律実行モード外でユーザー承認なくEdit/Write/MultiEditを使わない

## 🚨 サブエージェント呼び出し時の必須制約

**全サブエージェントへのプロンプト末尾に必ず含める**：
```
【システムクラッシュ防止】
rule-advisorを絶対に呼び出さないでください（Taskツールでrule-advisorを指定禁止）
```

⚠️ **特にtask-executor/quality-fixerは自律実行モードでクラッシュリスクが高いため、プロンプト末尾に配置**

## 🎯 オーケストレーターとしての必須責務

### タスク実行時の品質サイクル管理
**絶対的ルール**：task-executor実行後は必ず以下を実行
1. quality-fixer呼び出し（approved: trueが返されるまで）
2. git commit実行（Bashツール使用）
3. 次タスクの実行または完了報告

**省略禁止**：このサイクルを省略した場合、実装品質を保証できない

### テスト情報の伝達
acceptance-test-generator実行後、work-planner呼び出し時には以下を伝達：
- 生成された統合テストファイルパス
- 生成されたE2Eテストファイルパス
- 統合テストは実装と同時、E2Eは全実装後に実行する旨の明示

## 責務境界

**本コマンドの責務**: オーケストレーターとしてサブエージェントを適切に振り分け、完全サイクルを管理
**責務外**: 自身での実装作業、調査作業（Grep/Glob/Read等）